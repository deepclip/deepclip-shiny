library(shiny)
library(shinydashboard)

redirectJobHandlerCode <- "Shiny.addCustomMessageHandler('redirectJob', function(jobid) { window.location='?jobid='+jobid; });"
  
shinyUI(tagList(
  tags$head(tags$script(redirectJobHandlerCode)),
  dashboardPage(title="DeepCLIP",
    dashboardHeader(title="DeepCLIP"),
    dashboardSidebar(
      sidebarMenu(
        menuItem("Dashboard", tabName="dashboard"),
        menuItem("Documentation", tabName="documentation"),
        menuItem("About", tabName="about")
      )
    ),
    dashboardBody(
      tabItems(
        tabItem(tabName="dashboard",
          conditionalPanel("output.jobID == ''",
            fluidRow(
              box(title="Binding sequences", status="primary",
                p("Select how binding sequences will be provided. If BED file is selected, a target species and assembly must be selected as well."),
                fluidRow(
                  column(width=6, selectInput("seqFormat", "File format", c("FASTA file"="fasta", "BED file"="bed"))),
                  column(width=6, selectInput("seqAssembly", "Assembly", c("Human (GRCh38/hg38)"="hg38", "Human (GRCh37/hg19)"="hg19", "Mouse (GRCm38/mm10)"="mm10")))
                ),
                fileInput("seqFile", "Sequence file")
              ),
              box(title="Background sequences", status="primary",
                p("Select how background sequences should be generated."),
                tags$ul(
                  tags$li("If FASTA file is selected a FASTA file containing sequences must be provided."),
                  tags$li("If Generate from BED file is selected sequences will be generated from the provided BED file containing binding sequences."),
                  tags$li("If Shuffle input is selected sequences will be generated by reshuffling the provided binding sequences.")
                ),
                selectInput("bkgSource", "Data source", c("FASTA file"="fasta", "Generate from BED file"="bed", "Shuffle input"="shuffle")),
                fileInput("bkgFile", "FASTA file")
              ),
              box(title="Parameters", status="primary",
                p("Data preprocessing:"),
                tags$ul(
                  tags$li("Min. sequence length: all sequences shorter than this will be discarded."),
                  tags$li("Max. sequence length: all sequences longer than this will be discarded."),
                  tags$li("If Pad sequences is given all sequences will be padded with this number of surrounding bases. (BED file only)"),
                  tags$li("If Fixed sequence width is given all sequences will be trimmed/padded to fit this length. (BED file only)")
                ),
                fluidRow(
                  column(width=3, numericInput("minLength", "Min. sequence length", min=1, max=100, value=1)),
                  column(width=3, numericInput("maxLength", "Max. sequence length", min=1, max=100, value=100)),
                  column(width=3, numericInput("bedWidth", "Fixed sequence width", min=1, max=100, value=NA)),
                  column(width=3, numericInput("bedPadding", "Pad sequences", min=0, max=20, value=NA))
                )
              )
            ),
            actionButton("trainButton", "Train network", class="btn-lg btn-primary")
          ),
          conditionalPanel("output.jobStatus == 0",
            div(class="well", style="max-width:600px; margin:auto; text-align:center;",
              h2("Training network"),
              tags$img(src="img/spinner.gif"),
              p("DeepCLIP is currently training your network. This page will automatically redirect once the training is complete."),
              p("You can bookmark this page and come back later.")
            )
          ),
          conditionalPanel("output.jobStatus == 1",
            h1("Evaluate model")
          )
        ),
        tabItem(tabName="documentation", h1("Documentation")),
        tabItem(tabName="about",
          h1("About DeepCLIP"),
          h2("Citation"),
          p("If you use DeepCLIP in your research, we kindly ask you to cite the following publication:"),
          tags$blockquote("Citation details to be announced."),
          h2("Contact"),
          p("If you want to contact us regarding DeepCLIP, please contact us in the following order:")
        )
      )
    )
  )
))
